var express=require("express"),app=express(),server=require("http").createServer(app),io=require("socket.io")(server),bodyParser=require("body-parser"),xmpp=require("simple-xmpp");app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.set("views",__dirname+"/views"),app.set("view engine","jade"),app.use(express["static"]("public")),app.get("/",function(e,r){r.render("index",{title:"Home"})}),app.post("/",function(e,r){var t=e.body.username,s=e.body.password;e.body.host;xmpp.connect({jid:t,password:s,host:"192.241.244.151",port:5222}),xmpp.getRoster(),xmpp.on("online",function(e){console.log("Connected with JID: "+e.jid.user)}),r.redirect("/chat/"+t)}),app.get("/chat/:jid",function(e,r){var t=e.params.jid,s=[];xmpp.on("stanza",function(e){"roster_0"==e.attrs.id&&e.children[0].children.forEach(function(e,r){var t={name:e.attrs.jid};s.push(t)})}),r.render("chat",{username:t,contacts:s})}),io.on("connection",function(e){xmpp.on("chat",function(r,t){e.emit("received",{from:r,message:t})}),xmpp.on("error",function(r){e.emit("error",r)}),xmpp.on("subscribe",function(r){e.emit("subscription",r)}),e.on("sent",function(e){console.log("sending chat"),xmpp.send(e.to,e.message)}),e.on("accepted",function(r){r.accept&&(xmpp.acceptSubscription(r.contact),e.emit("add-contact",r.contact))})}),server.listen(3e3,function(){console.log("There ya go!")});var gulp=require("gulp"),sass=require("gulp-ruby-sass"),autoprefixer=require("gulp-autoprefixer"),uglify=require("gulp-uglify"),imagemin=require("gulp-imagemin"),rename=require("gulp-rename"),concat=require("gulp-concat"),notify=require("gulp-notify"),cache=require("gulp-cache"),livereload=require("gulp-livereload"),del=require("del");gulp.task("scripts",function(){return gulp.src("*.js").pipe(concat("main.js")).pipe(gulp.dest("dist/assets/js")).pipe(rename({suffix:".min"})).pipe(uglify()).pipe(gulp.dest("dist/assets/js")).pipe(notify({message:"Scripts task complete"}))}),gulp.task("clean",function(){return del(["dist/assets/js"])}),gulp.task("default",["clean"],function(){gulp.start("scripts")}),gulp.task("watch",function(){gulp.watch("/**/*.js",["scripts"])}),gulp.task("watch",function(){livereload.listen(),gulp.watch(["dist/**"]).on("change",livereload.changed)});